# replicaCount: 50; формула распределения: 120 партиций ÷ 50 подов ≈ 2.4 партиции на под.
replicaCount: 50

image:
  repository: docker.io/antonpatsev/strimzi-kafka-chaos-testing
  pullPolicy: IfNotPresent
  tag: "0.2.10"

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  annotations: {}
  name: ""

podAnnotations: {}

podSecurityContext: {}
  # fsGroup: 2000

securityContext: {}
  # capabilities:
  #   drop:
  #   - ALL
  # readOnlyRootFilesystem: true
  # runAsNonRoot: true
  # runAsUser: 1000

# Формула ресурсов: fetch 100MB + Avro decode + Redis → limits.
resources:
  limits:
    cpu: 2000m    # 2 × 1000m на под (decode + fetch + Redis)
    memory: 1Gi   # 256Mi base + fetch buffer + Avro + metrics ≈ 1Gi
  requests:
    cpu: 500m     # 0.5 ядра гарантировано на под
    memory: 256Mi # база для одного consumer-пода

nodeSelector: {}

tolerations: []

affinity: {}

autoscaling:
  enabled: false
  minReplicas: 10   # формула: 120 партиций / целевое число партиций на под
  maxReplicas: 100  # minReplicas × 10 — запас при autoscaling
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80

# Конфигурация Kafka (SASL SCRAM-SHA-512)
kafka:
  # Сервис Strimzi bootstrap (работает между namespace через DNS)
  brokers: "kafka-cluster-kafka-bootstrap.kafka-cluster.svc.cluster.local:9092"
  topic: "test-topic"
  groupId: "test-group"
  # Учётные данные KafkaUser — только через Secret (kind: Secret). Strimzi создаёт Secret myuser с ключом password.
  username: "myuser"
  existingSecret: "myuser"
  existingSecretPasswordKey: "password"

# Конфигурация Schema Registry
schemaRegistry:
  # Сервис развёрнут в namespace "schema-registry" в этом репозитории
  url: "http://schema-registry.schema-registry:8081"

# Redis для верификации доставки (получение данных из Redis, сверка хеша, счётчики, SLO)
redis:
  addr: "redis.redis.svc.cluster.local:6379"
  password: ""
  # keyPrefix: "kafka-msg:"
  sloSeconds: 120  # формула: допустимая задержка доставки (сек); 120 = 2 мин

# Конфигурация проверки здоровья
health:
  port: 8080
  livenessProbe:
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  readinessProbe:
    initialDelaySeconds: 15
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
