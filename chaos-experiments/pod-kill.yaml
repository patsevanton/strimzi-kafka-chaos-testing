# PodChaos: Убийство одного пода брокера Kafka
# Тестирует: Отказоустойчивость при потере одного брокера (ISR сохраняется: 2 >= min.insync.replicas)
# Ожидаемый результат: Партиции переизбирают лидера, producer/consumer переподключаются,
# under-replicated partitions появляются и исчезают после восстановления пода.
apiVersion: chaos-mesh.org/v1alpha1
kind: PodChaos
metadata:
  name: kafka-pod-kill
  namespace: kafka-cluster
spec:
  action: pod-kill
  mode: one
  selector:
    namespaces:
      - kafka-cluster
    labelSelectors:
      strimzi.io/cluster: kafka-cluster
      strimzi.io/pool-name: broker
---
# Schedule: Убийство случайного брокера Kafka каждые 5 минут (непрерывный хаос под нагрузкой)
apiVersion: chaos-mesh.org/v1alpha1
kind: Schedule
metadata:
  name: kafka-pod-kill-scheduled
  namespace: kafka-cluster
spec:
  schedule: "*/5 * * * *"
  type: PodChaos
  podChaos:
    action: pod-kill
    mode: one
    selector:
      namespaces:
        - kafka-cluster
      labelSelectors:
        strimzi.io/cluster: kafka-cluster
        strimzi.io/pool-name: broker
