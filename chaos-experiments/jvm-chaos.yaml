# JVMChaos: Принудительный GC на брокерах Kafka
apiVersion: chaos-mesh.org/v1alpha1
kind: JVMChaos
metadata:
  name: kafka-jvm-gc
  namespace: kafka-cluster
spec:
  action: gc
  mode: one
  selector:
    namespaces:
      - kafka-cluster
    labelSelectors:
      strimzi.io/cluster: kafka-cluster
      strimzi.io/kind: Kafka
  duration: "30s"
---
# JVMChaos: CPU stress в JVM
apiVersion: chaos-mesh.org/v1alpha1
kind: JVMChaos
metadata:
  name: kafka-jvm-cpu-stress
  namespace: kafka-cluster
spec:
  action: stress
  mode: one
  selector:
    namespaces:
      - kafka-cluster
    labelSelectors:
      strimzi.io/cluster: kafka-cluster
      strimzi.io/kind: Kafka
  cpuCount: 2
  duration: "1m"
---
# JVMChaos: Memory stress в JVM
apiVersion: chaos-mesh.org/v1alpha1
kind: JVMChaos
metadata:
  name: kafka-jvm-memory-stress
  namespace: kafka-cluster
spec:
  action: stress
  mode: one
  selector:
    namespaces:
      - kafka-cluster
    labelSelectors:
      strimzi.io/cluster: kafka-cluster
      strimzi.io/kind: Kafka
  memType: heap
  duration: "1m"
---
# JVMChaos: Задержка в методе append
apiVersion: chaos-mesh.org/v1alpha1
kind: JVMChaos
metadata:
  name: kafka-jvm-method-latency
  namespace: kafka-cluster
spec:
  action: latency
  mode: one
  selector:
    namespaces:
      - kafka-cluster
    labelSelectors:
      strimzi.io/cluster: kafka-cluster
      strimzi.io/kind: Kafka
  class: kafka.log.UnifiedLog
  method: append
  latency: 500
  duration: "1m"
---
# JVMChaos: Исключение в handleProduceRequest
apiVersion: chaos-mesh.org/v1alpha1
kind: JVMChaos
metadata:
  name: kafka-jvm-exception
  namespace: kafka-cluster
spec:
  action: exception
  mode: one
  selector:
    namespaces:
      - kafka-cluster
    labelSelectors:
      strimzi.io/cluster: kafka-cluster
      strimzi.io/kind: Kafka
  class: kafka.server.KafkaApis
  method: handleProduceRequest
  exception: "java.io.IOException(\"Chaos test exception\")"
  duration: "30s"
